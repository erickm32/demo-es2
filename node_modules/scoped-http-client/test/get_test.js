// Generated by CoffeeScript 1.10.0
(function() {
  var ScopedClient, assert, called, http, server;

  ScopedClient = require('../src');

  http = require('http');

  assert = require('assert');

  called = 0;

  server = http.createServer(function(req, res) {
    res.writeHead(200, {
      'Content-Type': 'text/plain'
    });
    return res.end(req.method + " " + req.url + " -- hello " + req.headers['accept']);
  });

  server.listen(9999);

  server.on('listening', function() {
    var client;
    client = ScopedClient.create('http://localhost:9999', {
      headers: {
        accept: 'text/plain'
      }
    });
    return client.get(function(err, req) {
      return assert.equal('localhost:9999', req.getHeader('host'));
    })(function(err, resp, body) {
      called++;
      assert.equal(200, resp.statusCode);
      assert.equal('text/plain', resp.headers['content-type']);
      assert.equal('GET / -- hello text/plain', body);
      return client.path('/a').query('b', '1').get()(function(err, resp, body) {
        called++;
        assert.equal(200, resp.statusCode);
        assert.equal('text/plain', resp.headers['content-type']);
        assert.equal('GET /a?b=1 -- hello text/plain', body);
        return server.close();
      });
    });
  });

  process.on('exit', function() {
    return assert.equal(2, called);
  });

}).call(this);
