// Generated by CoffeeScript 1.10.0
(function() {
  var ScopedClient, Sys, assert, called, http, len, server;

  ScopedClient = require('../src');

  Sys = require('sys');

  http = require('http');

  assert = require('assert');

  called = 0;

  len = null;

  server = http.createServer(function(req, res) {
    var body;
    body = '';
    req.on('data', function(chunk) {
      return body += chunk;
    });
    return req.on('end', function() {
      len = req.headers['content-length'];
      res.writeHead(200, {
        'Content-Type': 'text/plain'
      });
      return res.end(req.method + " hello: " + body);
    });
  });

  server.listen(9999);

  server.on('listening', function() {
    var client;
    client = ScopedClient.create('http://localhost:9999');
    return client.post(function(err, req) {
      called++;
      req.write('boo', 'ascii');
      return req.write('ya', 'ascii');
    })(function(err, resp, body) {
      called++;
      assert.equal(200, resp.statusCode);
      assert.equal('text/plain', resp.headers['content-type']);
      assert.equal('POST hello: booya', body);
      return client.post(function(err, req) {
        return req.on('response', function(resp) {
          resp.on('data', function(chunk) {});
          return resp.on('end', function() {
            called++;
            return client.post("word up")(function(err, resp, body) {
              called++;
              assert.equal('7', len);
              return server.close();
            });
          });
        });
      })();
    });
  });

  process.on('exit', function() {
    return assert.equal(4, called);
  });

}).call(this);
