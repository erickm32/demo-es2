// Generated by CoffeeScript 1.10.0
(function() {
  var ScopedClient, assert, called, curr, http, len, server, ua;

  ScopedClient = require('../src');

  http = require('http');

  assert = require('assert');

  called = 0;

  curr = null;

  ua = null;

  len = null;

  server = http.createServer(function(req, res) {
    var body;
    body = '';
    req.on('data', function(chunk) {
      return body += chunk;
    });
    return req.on('end', function() {
      var respBody;
      curr = req.method;
      ua = req.headers['user-agent'];
      len = req.headers['content-length'];
      respBody = curr + " hello: " + body + " " + ua;
      res.writeHead(200, {
        'content-type': 'text/plain',
        'content-length': Buffer.byteLength(respBody),
        'x-sent-authorization': req.headers.authorization
      });
      if (curr !== 'HEAD') {
        res.write(respBody);
      }
      return res.end();
    });
  });

  server.listen(9999);

  server.addListener('listening', function() {
    var client;
    client = ScopedClient.create('http://localhost:9999').headers({
      'user-agent': 'bob'
    });
    return client.del("")(function(err, resp, body) {
      called++;
      assert.equal('DELETE', curr);
      assert.equal('bob', ua);
      assert.equal('0', len);
      assert.equal("DELETE hello:  bob", body);
      return client.header('user-agent', 'fred').auth('monkey', 'town').put('yéå')(function(err, resp, body) {
        called++;
        assert.equal('PUT', curr);
        assert.equal('fred', ua);
        assert.equal("PUT hello: yéå fred", body);
        assert.equal('Basic bW9ua2V5OnRvd24=', resp.headers['x-sent-authorization']);
        return client.auth('mode:selektor').head()(function(err, resp, body) {
          called++;
          assert.equal('HEAD', curr);
          assert.equal('Basic bW9kZTpzZWxla3Rvcg==', resp.headers['x-sent-authorization']);
          return server.close();
        });
      });
    });
  });

  process.on('exit', function() {
    return assert.equal(3, called);
  });

}).call(this);
